<h2>Foods and Ingredients</h2>

{% for m in messages %}
<p style="color: green;">{{ m }}</p>
{% endfor %}

<hr>

<h3>Existing Ingredients</h3>
<table border="1" cellpadding="5">
  <tr><th>Name</th><th>Protein</th><th>Calories</th></tr>
  {% for ing in ingredients %}
  <tr>
    <td>{{ ing.name }}</td>
    <td>{{ ing.protein }}</td>
    <td>{{ ing.calories }}</td>
    <td>
      <form action="{{ url_for('foods.delete_ingredient', ingredient_id=ing.id) }}"
            method="post" style="display:inline;">
        <button type="submit">Delete</button>
      </form>
    </td>
    <p>deleting a ingredient removes it from all foods, if it is the last ingredient in a food; the food is deleted</p>
  </tr>
  {% endfor %}
</table>

<h3>Add Ingredient</h3>
<form method="post">
  <input type="text" name="ingredient_name" placeholder="Ingredient Name" required>
  <input type="number" step="0.01" name="ingredient_protein" placeholder="Protein (g)" required>
  <input type="number" step="0.01" name="ingredient_calories" placeholder="Calories" required>
  <button type="submit" name="ingredient_submit">Add Ingredient</button>
</form>

<hr>

<h3>Existing Foods</h3>
<table border="1" cellpadding="5">
  <tr>
    <th>Food Name</th><th>Meal Class</th><th>Ingredients</th><th>Total Protein</th><th>Total Calories</th>
  </tr>
  {% for food in foods.values() %}
  <tr>
    <td>{{ food.name }}</td>
    <td>{{ food.class }}</td>
    <td>
      {% for ing in food.ingredients %}
        {{ ing.quantity }} x {{ ing.name }}<br>
      {% endfor %}
    </td>
    <td>
      {{ food.ingredients | sum(attribute='protein', quantity_attribute='quantity') }}
    </td>
    <td>
      {{ food.ingredients | sum(attribute='calories', quantity_attribute='quantity') }}
    </td>
    <td>
      <form action="{{ url_for('foods.delete_food', food_id=food.id) }}" method="post" style="display:inline;">
        <button type="submit">Delete Food</button>
      </form>
    </td>
  </tr>
  {% endfor %}
</table>

<h3>Add Food</h3>
<form method="post">
  <input type="text" name="food_name" placeholder="Food Name" required>
  <select name="food_class" required>
    <option value="Breakfast/Supper">Breakfast/Supper</option>
    <option value="Lunch/Dinner">Lunch/Dinner</option>
    <option value="Snack">Snack</option>
  </select><br><br>

  <label>Ingredients (set quantity â‰¥1 to include):</label><br>
  {% for ing in ingredients %}
    <input type="number" step="0.01" name="ingredient_{{ ing.id }}" min="0" value="0">
    {{ ing.name }} (Protein: {{ ing.protein }}, Calories: {{ ing.calories }})<br>
  {% endfor %}

  <button type="submit" name="food_submit">Add Food</button>
</form>